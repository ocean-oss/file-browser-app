---
ocean:
  version: "1"
steps:
- engines:
  - name: file-browser
    vars:
      - name: file_browser_port
        value: reserve_port()
    orchestrator:
      type: Orchestrator::MainWithWorkers
      deploy_to_main: true
      deploy_to_workers: false
      snapshot:
        registry:
          name: docker_hub
        image:
          name: filebrowser/filebrowser
        name: latest
      container:
        user: "{{ workspace.user.uid }}:{{ workspace.user.gid }}"
        workdir: "/work"
        mounts:
          engine: "/etc/ocean"
          data_stores: "{{ orchestrator.container.workdir }}"
          ssh: "/home/{{ workspace.user.name }}/.ssh"
      nodes:
        env_vars:
          - name: FB_PORT
            value: "{{ vars.file_browser_port }}"
          - name: FB_NOAUTH
            value: true
          - name: FB_DATABASE
            value: "{{ orchestrator.container.mounts.engine }}/etc/file_manager.db"
          - name: FB_ROOT
            value: "{{ orchestrator.container.workdir }}"
    views:
      buttons:
        - node_target: main
          label: Open File Manager
          url: "http://{{ views.buttons.self.node.public_ip }}:{{ vars.file_browser_port }}"
